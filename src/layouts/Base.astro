---
import TwSizeIndicator from "@/components/TwSizeIndicator.astro";
import config from "@/config/config.json";
import theme from "@/config/theme.json";
import { plainify } from "@/lib/utils/textConverter";
import Footer from "@/partials/Footer.astro";
import Header from "@/partials/Header.astro";
import "@/styles/main.scss";
import { ViewTransitions } from "astro:transitions";

// font families
const pf = theme.fonts.font_family.primary;

let fontPrimary;
if (theme.fonts.font_family.primary) {
  fontPrimary = theme.fonts.font_family.primary
    .replace(/\+/g, " ")
    .replace(/:[ital,]*[ital@]*[wght@]*[0-9,;]+/gi, "");
}

// types for frontmatters
export interface Props {
  title?: string;
  meta_title?: string;
  description?: string;
  image?: string;
  noindex?: boolean;
  canonical?: string;
}

// distructure frontmatters
const { title, meta_title, description, image, noindex, canonical } =
  Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17354344135"></script>
        <script is:inline>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'AW-17354344135');
        </script>
    <!-- favicon -->
    <link rel="shortcut icon" href={config.site.favicon} />
    <!-- theme meta -->
    <meta name="theme-name" content="bigspring-light-astro" />
    <meta name="msapplication-TileColor" content="#000000" />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: light)"
      content="#fff"
    />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: dark)"
      content="#000"
    />
    <meta name="generator" content={Astro.generator} />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href={`https://fonts.googleapis.com/css2?family=${pf}&display=swap`} rel="stylesheet" />

    <!-- responsive meta -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=5"
    />

    <!-- title -->
    <title>
      {plainify(meta_title ? meta_title : title ? title : config.site.title)}
    </title>

    <!-- canonical url -->
    {canonical && <link rel="canonical" href={canonical} item-prop="url" />}

    <!-- noindex robots -->
    {noindex && <meta name="robots" content="noindex,nofollow" />}

    <!-- meta-description -->
    <meta
      name="description"
      content={plainify(
        description ? description : config.metadata.meta_description,
      )}
    />

    <ViewTransitions />

    <!-- author from config.json -->
    <meta name="author" content={config.metadata.meta_author} />

    <!-- og-title -->
    <meta
      property="og:title"
      content={plainify(
        meta_title ? meta_title : title ? title : config.site.title,
      )}
    />

    <!-- og-description -->
    <meta
      property="og:description"
      content={plainify(
        description ? description : config.metadata.meta_description,
      )}
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content={`${config.site.base_url}/${Astro.url.pathname.replace("/", "")}`}
    />

    <!-- twitter-title -->
    <meta
      name="twitter:title"
      content={plainify(
        meta_title ? meta_title : title ? title : config.site.title,
      )}
    />

    <!-- twitter-description -->
    <meta
      name="twitter:description"
      content={plainify(
        description ? description : config.metadata.meta_description,
      )}
    />

    <!-- og-image -->
    <meta
      property="og:image"
      content={`${config.site.base_url}${
        image ? image : config.metadata.meta_image
      }`}
    />

    <!-- twitter-image -->
    <meta
      name="twitter:image"
      content={`${config.site.base_url}${
        image ? image : config.metadata.meta_image
      }`}
    />
    <meta name="twitter:card" content="summary_large_image" />
        <!-- Permite inyectar tags en el <head> desde cada página -->
          <slot name="head" />
  </head>
<body>
  <TwSizeIndicator />
  <Header />
  <main id="main-content">
    <slot />
  </main>

<a
  href="https://wa.me/5493425662160"
  target="_blank"
  rel="noopener noreferrer"
  class="fixed bottom-20 right-6 z-50 bg-green-500 p-3 rounded-full shadow-lg hover:bg-green-600 transition-all"
  aria-label="WhatsApp"
>
  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
    <path d="M20.52 3.48A11.77 11.77 0 0 0 12.01 0a11.9 11.9 0 0 0-10.2 17.94L0 24l6.21-1.63A11.91 11.91 0 0 0 12 24a11.85 11.85 0 0 0 8.47-3.51A11.88 11.88 0 0 0 24 12.02c0-3.19-1.25-6.18-3.48-8.54Zm-8.49 18.3a9.42 9.42 0 0 1-4.8-1.32l-.34-.2-3.68.97.98-3.58-.22-.37A9.46 9.46 0 0 1 2.54 12a9.47 9.47 0 1 1 9.49 9.78Zm5.22-7.13c-.29-.15-1.7-.84-1.96-.94s-.45-.15-.63.15-.72.94-.89 1.14-.33.22-.63.07a7.68 7.68 0 0 1-3.39-2.96c-.25-.44.25-.41.72-1.37.08-.17.04-.31-.02-.45s-.63-1.52-.86-2.08c-.23-.56-.46-.48-.63-.48h-.54a1 1 0 0 0-.73.34 3.07 3.07 0 0 0-.95 2.28c0 1.34.97 2.63 1.1 2.82.15.2 1.9 3 4.61 4.22.64.28 1.14.45 1.53.58.64.2 1.23.17 1.7.1.52-.08 1.7-.7 1.94-1.37.24-.68.24-1.27.17-1.37-.07-.1-.27-.15-.56-.3Z"/>
  </svg>
</a>

  <a
    href="/contact"
    class="fixed bottom-6 right-6 z-50 bg-primary text-white px-6 py-3 rounded-full shadow-lg text-lg hover:bg-primary-dark transition-all"
  >
    Contáctenos
  </a>

  <Footer />
</body>

</html>
